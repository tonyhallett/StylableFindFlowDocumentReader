<UserControl x:Name="fm"
  x:Class="StylableFindFlowDocumentReader.FindMenu"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:local="clr-namespace:StylableFindFlowDocumentReader"
  d:DesignHeight="450"
  d:DesignWidth="800"
  mc:Ignorable="d">
  <Menu
    VerticalAlignment="Center"
    Background="Transparent"
    IsMainMenu="false"
    IsTabStop="false"
    KeyboardNavigation.DirectionalNavigation="Continue"
    KeyboardNavigation.TabNavigation="Continue">
    <Menu.Resources>
      <local:NullToUnsetValueConverter
        x:Key="NullToUnsetValueConverter" />
      <Style
        x:Key="OptionsMenuItemStyle"
        TargetType="{x:Type MenuItem}">
        <Setter Property="FrameworkElement.VerticalAlignment" Value="Center" />
        <Setter Property="FrameworkElement.HorizontalAlignment" Value="Center" />
        <Setter Property="Control.BorderThickness" Value="0" />
        <Setter Property="FrameworkElement.Width" Value="15" />
        <Setter Property="FrameworkElement.Height" Value="18" />
        <Setter Property="FrameworkElement.Margin" Value="0,0,1,0" />
        <Setter Property="Control.Padding" Value="0" />
        <Setter Property="Control.BorderBrush" Value="Transparent" />
        <Setter Property="FocusVisualStyle" Value="{Binding RelativeSource={RelativeSource AncestorType=local:FindMenu}, Path=DropDownFocusVisualStyle}" />
        <Setter Property="Control.Template">
          <Setter.Value>
            <ControlTemplate
              TargetType="{x:Type MenuItem}">
              <Border
                Margin="{TemplateBinding FrameworkElement.Margin}"
                Padding="{TemplateBinding Control.Padding}"
                Background="Transparent">
                <Grid
                  Width="{TemplateBinding FrameworkElement.Width}"
                  Height="{TemplateBinding FrameworkElement.Height}">
                  <Border x:Name="TrimBorder"
                    Background="Transparent"
                    BorderThickness="1">
                    <Canvas
                      Width="5"
                      Height="4">
                      <!--  Drop down  -->
                      <Path x:Name="FindOptionsIcon"
                        Data="F1 M -2,0 L 5,0 1.5,4 "
                        Fill="{Binding RelativeSource={RelativeSource AncestorType=local:FindMenu}, Path=DropDownGlyphBrush}" />
                    </Canvas>
                  </Border>
                  <Popup x:Name="SubMenuPopup"
                    AllowsTransparency="true"
                    Focusable="false"
                    IsOpen="{Binding Path=IsSubmenuOpen, RelativeSource={RelativeSource TemplatedParent}}"
                    Placement="Bottom"
                    PopupAnimation="{DynamicResource {x:Static SystemParameters.MenuPopupAnimationKey}}"
                    VerticalOffset="0">
                    <Grid
                      Name="SubMenu">
                      <Border
                        Name="SubMenuBorder"
                        Background="{Binding RelativeSource={RelativeSource AncestorType=local:FindMenu}, Path=MenuBackground}"
                        BorderBrush="{Binding RelativeSource={RelativeSource AncestorType=local:FindMenu}, Path=MenuBorderBrush}"
                        BorderThickness="1" />
                      <ScrollViewer
                        Margin="1"
                        Style="{DynamicResource {ComponentResourceKey TypeInTargetAssembly={x:Type FrameworkElement},
                                                                      ResourceId=MenuScrollViewer}}"
                        CanContentScroll="true">
                        <ItemsPresenter
                          Margin="2"
                          KeyboardNavigation.DirectionalNavigation="Cycle" />
                      </ScrollViewer>
                    </Grid>
                  </Popup>
                </Grid>
              </Border>
              <!--  drop down button  -->
              <ControlTemplate.Triggers>
                <Trigger Property="UIElement.IsEnabled" Value="false">
                  <Setter TargetName="FindOptionsIcon" Property="Fill" Value="{Binding RelativeSource={RelativeSource AncestorType=local:FindMenu}, Path=DropDownGlyphDisabledBrush}" />
                </Trigger>
                <Trigger Property="UIElement.IsMouseOver" Value="true">
                  <Setter TargetName="TrimBorder" Property="Background">
                    <Setter.Value>
                      <PriorityBinding>
                        <Binding
                          Converter="{StaticResource ResourceKey=NullToUnsetValueConverter}"
                          Path="DropDownBackgroundMouseOver"
                          RelativeSource="{RelativeSource AncestorType=local:FindMenu}" />
                        <Binding
                          Path="DropDownStateBackground"
                          RelativeSource="{RelativeSource AncestorType=local:FindMenu}" />
                      </PriorityBinding>
                    </Setter.Value>
                  </Setter>
                  <Setter TargetName="TrimBorder" Property="BorderBrush">
                    <Setter.Value>
                      <PriorityBinding>
                        <Binding
                          Converter="{StaticResource ResourceKey=NullToUnsetValueConverter}"
                          Path="DropDownBorderMouseOverBrush"
                          RelativeSource="{RelativeSource AncestorType=local:FindMenu}" />
                        <Binding
                          Path="DropDownStateBorderBrush"
                          RelativeSource="{RelativeSource AncestorType=local:FindMenu}" />
                      </PriorityBinding>
                    </Setter.Value>
                  </Setter>
                  <Setter TargetName="FindOptionsIcon" Property="Fill">
                    <Setter.Value>
                      <PriorityBinding>
                        <Binding
                          Converter="{StaticResource ResourceKey=NullToUnsetValueConverter}"
                          Path="DropDownGlyphMouseOverBrush"
                          RelativeSource="{RelativeSource AncestorType=local:FindMenu}" />
                        <Binding
                          Path="DropDownStateGlyphBrush"
                          RelativeSource="{RelativeSource AncestorType=local:FindMenu}" />
                      </PriorityBinding>
                    </Setter.Value>
                  </Setter>
                </Trigger>
                <Trigger Property="UIElement.IsKeyboardFocused" Value="true">
                  <Setter TargetName="TrimBorder" Property="Background">
                    <Setter.Value>
                      <PriorityBinding>
                        <Binding
                          Converter="{StaticResource ResourceKey=NullToUnsetValueConverter}"
                          Path="DropDownBackgroundFocusedBrush"
                          RelativeSource="{RelativeSource AncestorType=local:FindMenu}" />
                        <Binding
                          Path="DropDownStateBackground"
                          RelativeSource="{RelativeSource AncestorType=local:FindMenu}" />
                      </PriorityBinding>
                    </Setter.Value>
                  </Setter>
                  <Setter TargetName="TrimBorder" Property="BorderBrush">
                    <Setter.Value>
                      <PriorityBinding>
                        <Binding
                          Converter="{StaticResource ResourceKey=NullToUnsetValueConverter}"
                          Path="DropDownBorderFocusedBrush"
                          RelativeSource="{RelativeSource AncestorType=local:FindMenu}" />
                        <Binding
                          Path="DropDownStateBorderBrush"
                          RelativeSource="{RelativeSource AncestorType=local:FindMenu}" />
                      </PriorityBinding>
                    </Setter.Value>
                  </Setter>
                  <Setter TargetName="FindOptionsIcon" Property="Fill">
                    <Setter.Value>
                      <PriorityBinding>
                        <Binding
                          Converter="{StaticResource ResourceKey=NullToUnsetValueConverter}"
                          Path="DropDownGlyphFocusedBrush"
                          RelativeSource="{RelativeSource AncestorType=local:FindMenu}" />
                        <Binding
                          Path="DropDownStateGlyphBrush"
                          RelativeSource="{RelativeSource AncestorType=local:FindMenu}" />
                      </PriorityBinding>
                    </Setter.Value>
                  </Setter>
                </Trigger>
                <MultiTrigger>
                  <MultiTrigger.Conditions>
                    <Condition Property="UIElement.IsMouseOver" Value="true" />
                    <Condition Property="UIElement.IsKeyboardFocused" Value="true" />
                  </MultiTrigger.Conditions>
                  <Setter TargetName="TrimBorder" Property="Background">
                    <Setter.Value>
                      <PriorityBinding>
                        <Binding
                          Converter="{StaticResource ResourceKey=NullToUnsetValueConverter}"
                          Path="DropDownBackgroundMouseOverFocused"
                          RelativeSource="{RelativeSource AncestorType=local:FindMenu}" />
                        <Binding
                          Path="DropDownStateBackground"
                          RelativeSource="{RelativeSource AncestorType=local:FindMenu}" />
                      </PriorityBinding>
                    </Setter.Value>
                  </Setter>
                  <Setter TargetName="TrimBorder" Property="BorderBrush">
                    <Setter.Value>
                      <PriorityBinding>
                        <Binding
                          Converter="{StaticResource ResourceKey=NullToUnsetValueConverter}"
                          Path="DropDownBorderMouseOverFocusedBrush"
                          RelativeSource="{RelativeSource AncestorType=local:FindMenu}" />
                        <Binding
                          Path="DropDownStateBorderBrush"
                          RelativeSource="{RelativeSource AncestorType=local:FindMenu}" />
                      </PriorityBinding>
                    </Setter.Value>
                  </Setter>
                  <Setter TargetName="FindOptionsIcon" Property="Fill">
                    <Setter.Value>
                      <PriorityBinding>
                        <Binding
                          Converter="{StaticResource ResourceKey=NullToUnsetValueConverter}"
                          Path="DropDownGlyphMouseOverFocusedBrush"
                          RelativeSource="{RelativeSource AncestorType=local:FindMenu}" />
                        <Binding
                          Path="DropDownStateGlyphBrush"
                          RelativeSource="{RelativeSource AncestorType=local:FindMenu}" />
                      </PriorityBinding>
                    </Setter.Value>
                  </Setter>
                </MultiTrigger>
                <Trigger Property="MenuItem.IsPressed" Value="true">
                  <Setter TargetName="TrimBorder" Property="Background">
                    <Setter.Value>
                      <PriorityBinding>
                        <Binding
                          Converter="{StaticResource ResourceKey=NullToUnsetValueConverter}"
                          Path="DropDownBackgroundPressed"
                          RelativeSource="{RelativeSource AncestorType=local:FindMenu}" />
                        <Binding
                          Path="DropDownStateBackground"
                          RelativeSource="{RelativeSource AncestorType=local:FindMenu}" />
                      </PriorityBinding>
                    </Setter.Value>
                  </Setter>
                  <Setter TargetName="TrimBorder" Property="BorderBrush">
                    <Setter.Value>
                      <PriorityBinding>
                        <Binding
                          Converter="{StaticResource ResourceKey=NullToUnsetValueConverter}"
                          Path="DropDownBorderPressedBrush"
                          RelativeSource="{RelativeSource AncestorType=local:FindMenu}" />
                        <Binding
                          Path="DropDownStateBorderBrush"
                          RelativeSource="{RelativeSource AncestorType=local:FindMenu}" />
                      </PriorityBinding>
                    </Setter.Value>
                  </Setter>
                  <Setter TargetName="FindOptionsIcon" Property="Fill">
                    <Setter.Value>
                      <PriorityBinding>
                        <Binding
                          Converter="{StaticResource ResourceKey=NullToUnsetValueConverter}"
                          Path="DropDownGlyphPressedBrush"
                          RelativeSource="{RelativeSource AncestorType=local:FindMenu}" />
                        <Binding
                          Path="DropDownStateGlyphBrush"
                          RelativeSource="{RelativeSource AncestorType=local:FindMenu}" />
                      </PriorityBinding>
                    </Setter.Value>
                  </Setter>
                </Trigger>
              </ControlTemplate.Triggers>
            </ControlTemplate>
          </Setter.Value>
        </Setter>
      </Style>
      <ControlTemplate
        x:Key="{ComponentResourceKey TypeInTargetAssembly={x:Type MenuItem},
                                     ResourceId=SubmenuItemTemplateKey}"
        TargetType="{x:Type MenuItem}">
        <Border x:Name="templateRoot"
          Background="{Binding RelativeSource={RelativeSource AncestorType=local:FindMenu}, Path=MenuItemBackground}"
          BorderBrush="{Binding RelativeSource={RelativeSource AncestorType=local:FindMenu}, Path=MenuItemBorderBrush}"
          BorderThickness="{TemplateBinding Control.BorderThickness}"
          SnapsToDevicePixels="true"
          TextElement.Foreground="{Binding RelativeSource={RelativeSource AncestorType=local:FindMenu}, Path=MenuItemForeground}">
          <Grid
            Margin="-1">
            <Grid.ColumnDefinitions>
              <ColumnDefinition
                Width="Auto"
                MinWidth="22"
                SharedSizeGroup="MenuItemIconColumnGroup" />
              <ColumnDefinition
                Width="13" />
              <ColumnDefinition
                Width="*" />
              <ColumnDefinition
                Width="30" />
              <ColumnDefinition
                Width="Auto"
                SharedSizeGroup="MenuItemIGTColumnGroup" />
              <ColumnDefinition
                Width="20" />
            </Grid.ColumnDefinitions>
            <ContentPresenter x:Name="Icon"
              Width="16"
              Height="16"
              Margin="3"
              HorizontalAlignment="Center"
              VerticalAlignment="Center"
              ContentSource="Icon"
              SnapsToDevicePixels="{TemplateBinding UIElement.SnapsToDevicePixels}" />
            <Border x:Name="GlyphPanel"
              Width="22"
              Height="22"
              Margin="-1,0,0,0"
              HorizontalAlignment="Center"
              VerticalAlignment="Center"
              Background="{Binding RelativeSource={RelativeSource AncestorType=local:FindMenu}, Path=SelectedGlyphBackground}"
              BorderBrush="{Binding RelativeSource={RelativeSource AncestorType=local:FindMenu}, Path=SelectedGlyphBorderBrush}"
              BorderThickness="1"
              ClipToBounds="false"
              Visibility="Hidden">
              <Path x:Name="Glyph"
                Width="10"
                Height="11"
                Fill="{Binding RelativeSource={RelativeSource AncestorType=local:FindMenu}, Path=SelectedGlyphBrush}"
                FlowDirection="LeftToRight">
                <Path.Data>
                  <Geometry>
                    F1 M 10.0,1.2 L 4.7,9.1 L 4.5,9.1 L 0,5.2 L 1.3,3.5 L 4.3,6.1L 8.3,0 L 10.0,1.2 Z
                  </Geometry>
                </Path.Data>
              </Path>
            </Border>
            <ContentPresenter x:Name="menuHeaderContainer"
              Grid.Column="2"
              Margin="{TemplateBinding Control.Padding}"
              HorizontalAlignment="Left"
              VerticalAlignment="Center"
              ContentSource="Header"
              RecognizesAccessKey="true"
              SnapsToDevicePixels="{TemplateBinding UIElement.SnapsToDevicePixels}" />
            <TextBlock x:Name="menuGestureText"
              Grid.Column="4"
              Margin="{TemplateBinding Control.Padding}"
              VerticalAlignment="Center"
              Opacity="0.7"
              Text="{TemplateBinding MenuItem.InputGestureText}" />
          </Grid>
        </Border>

        <ControlTemplate.Triggers>
          <Trigger Property="MenuItem.Icon" Value="{x:Null}">
            <Setter TargetName="Icon" Property="UIElement.Visibility" Value="Collapsed" />
          </Trigger>
          <Trigger Property="MenuItem.IsChecked" Value="true">
            <Setter TargetName="GlyphPanel" Property="UIElement.Visibility" Value="Visible" />
            <Setter TargetName="Icon" Property="UIElement.Visibility" Value="Collapsed" />
          </Trigger>
          <Trigger Property="MenuItem.IsHighlighted" Value="true">
            <Setter TargetName="templateRoot" Property="Border.Background" Value="{Binding RelativeSource={RelativeSource AncestorType=local:FindMenu}, Path=MenuItemHighlightedBackground}" />
            <Setter TargetName="templateRoot" Property="Border.BorderBrush" Value="{Binding RelativeSource={RelativeSource AncestorType=local:FindMenu}, Path=MenuItemHighlightedBorderBrush}" />
            <Setter TargetName="templateRoot" Property="TextElement.Foreground" Value="{Binding RelativeSource={RelativeSource AncestorType=local:FindMenu}, Path=MenuItemHighlightedForeground}" />
          </Trigger>
          <Trigger Property="UIElement.IsEnabled" Value="false">
            <Setter TargetName="templateRoot" Property="TextElement.Foreground" Value="Gray" />
          </Trigger>
          <MultiTrigger>
            <MultiTrigger.Conditions>
              <Condition Property="MenuItem.IsHighlighted" Value="true" />
              <Condition Property="UIElement.IsEnabled" Value="false" />
            </MultiTrigger.Conditions>
            <!--  todo  -->
          </MultiTrigger>
        </ControlTemplate.Triggers>
      </ControlTemplate>
    </Menu.Resources>
    <MenuItem x:Name="OptionsMenuItem"
      Style="{StaticResource OptionsMenuItemStyle}"
      IsTabStop="true"
      KeyboardNavigation.DirectionalNavigation="Continue"
      KeyboardNavigation.TabNavigation="Continue"
      ToolTip="{Binding ElementName=fm, Path=DropDownTooltip}"
      ToolTipService.IsEnabled="{Binding ElementName=fm, Path=ShowDropDownTooltip}"
      ToolTipService.ShowOnDisabled="true">
      <MenuItem x:Name="OptionsWholeWordMenuItem"
        Header="Match _whole word only"
        IsCheckable="true"
        IsChecked="{Binding MatchWholeWord}" />
      <MenuItem x:Name="OptionsCaseMenuItem"
        Header="Match _case"
        IsCheckable="true"
        IsChecked="{Binding MatchCase}" />
      <MenuItem x:Name="OptionsDiacriticMenuItem"
        Header="Match _diacritic"
        IsCheckable="true"
        IsChecked="{Binding MatchDiacritic}" />
      <MenuItem x:Name="OptionsKashidaMenuItem"
        Header="Match _kashida"
        IsCheckable="true"
        IsChecked="{Binding MatchKashida}" />
      <MenuItem x:Name="OptionsAlefHamzaMenuItem"
        Header="Match _alef hamza"
        IsCheckable="true"
        IsChecked="{Binding MatchAlefHamza}" />
    </MenuItem>
  </Menu>
</UserControl>
